#!/bin/ksh
#
# Copyright (c) 2003, 2020 Oracle and/or its affiliates. All rights reserved.
#
# This program and the accompanying materials are made available under the
# terms of the Eclipse Public License v. 2.0, which is available at
# http://www.eclipse.org/legal/epl-2.0.
#
# This Source Code may also be made available under the following Secondary
# Licenses when the conditions for such availability set forth in the
# Eclipse Public License v. 2.0 are satisfied: GNU General Public License,
# version 2 with the GNU Classpath Exception, which is available at
# https://www.gnu.org/software/classpath/license.html.
#
# SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0
#

# !!!!!
# !!!!! This script provides convenient access to the various JCK utilities.
# !!!!!

#set -x

# set platform-dependent variables
OS=`uname -s`
case "$OS" in
  SunOS )
    NULL=/dev/null
    MYNAME=`whence $0 2>$NULL`
    PATHSEP=":"
    FILESEP="/"
    PLATFORM=solaris
    TMPDIR=${TMPDIR:-"/tmp"}
    DEFAULT_JAVA=/java/re/jdk/1.3.1/archive/fcs/binaries/solsparc/bin/java
    ;;
  Windows_95 | Windows_98 |  Windows_NT )
    NULL=NUL
    MYNAME=`whence $0 2>$NULL`
    PATHSEP=";"
    FILESEP="\\"
    PLATFORM=win32
    TMPDIR=${TMPDIR:-"C:\\TEMP"}
    DEFAULT_JAVA=java
    ;;
  * )
    echo "Unrecognized system!"
    exit 1;
    ;;
esac

# try and guess the installation directory, by checking successive parent
# directories, looking for one that contains the starting class
find_root() {
    cd $1
    dir=`pwd`
    while [ "$dir" != ${FILESEP} ]; do
	if [ -f lib/jckutils.jar ]; then 
	    echo $dir
	    return
	fi
	cd ..
	dir=`pwd`
    done

    echo "can't find installation directory"
    exit 1
}

PRG=$MYNAME
PRGDIR=`dirname $PRG`
JCKUTILS_HOME=`find_root $PRGDIR`
echo "JCKUTILS HOME :::::::::::"
echo $JCKUTILS_HOME
RUNTIME_ARGS=""
APP_ARGS=""
for a in "$@" ; do
    if ja=`expr "$a" : '-J\(..*\)'` ; then 
	RUNTIME_ARGS="$RUNTIME_ARGS $ja"
    else 
	APP_ARGS="$APP_ARGS $a"
    fi
done

# otherwise run the main application

# set CLASSPATH to necessary stuff, NOT including users classpath
export CLASSPATH="${JCKUTILS_HOME:+${JCKUTILS_HOME}${FILESEP}classes${PATHSEP}${JCKUTILS_HOME}${FILESEP}lib${FILESEP}jckutils.jar${PATHSEP}${JCKUTILS_HOME}${FILESEP}lib${FILESEP}javatest.jar}${JCKUTILS_CLASSPATH:+${PATHSEP}${JCKUTILS_CLASSPATH}}"

# set JAVA to platform-specific default, unless overridden by user
# ignore JAVA_HOME as too arbitrary
JAVA=${JCKUTILS_JAVA:-${DEFAULT_JAVA}}

# program is used by the various tool to identify the command name
# in the help text generated by the -help or -usage options.
${JAVA} ${RUNTIME_ARGS} -Dprogram=`basename $PRG` \
	com.sun.jck.utils.`basename $PRG`.Main $APP_ARGS
